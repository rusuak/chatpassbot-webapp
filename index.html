<!doctype html>
<meta charset="utf-8">
<title>Open events</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  function run() {
    const wa = window.Telegram?.WebApp;
    // Если открыли вне Telegram, покажем подсказку
    if (!wa) {
      document.getElementById('status').textContent =
        "Open this page via Telegram WebApp link.";
      return;
    }
    try {
      wa.expand(); // косметика
      // Берём start_param, который приходит из ?startapp=...
      const startParam = wa.initDataUnsafe?.start_param || "";
      const org = startParam.startsWith("org:") ? startParam.slice(4) : startParam;

      // Отправляем данные боту через Telegram (без обращений к вашему серверу)
      wa.sendData(JSON.stringify({ t: "open_org", org }));

      // Закрываем WebApp — бот пришлёт список событий в чат
      setTimeout(() => wa.close(), 100);
    } catch (e) {
      document.getElementById('status').textContent =
        "Could not open. Please return to the chat and try again.";
    }
  }
  window.addEventListener('load', run);
</script>
<body style="font-family:system-ui, sans-serif; padding:24px">
  <h1 style="margin:0 0 12px">Opening…</h1>
  <p id="status">If nothing happens, return to the chat.</p>
</body>
